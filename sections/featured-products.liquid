<section class="py-16">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl font-heading font-semibold text-center mb-10">
      {{ title | default: 'Featured Products' }}
    </h2>

    <div
      class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
      x-data="{ products: [], loading: true }"
      x-init="
        ShopifyAPI.getCollection('{{ collection_handle | default: 'all' }}')
          .then(data => { products = data.products.slice(0, 8); loading = false; })
          .catch(() => { loading = false; })
      "
    >
      <template x-for="product in products" :key="product.id">
        <article class="group relative">
          <a :href="product.url" class="block overflow-hidden rounded-lg bg-muted aspect-square">
            <img
              :src="product.featured_image"
              :alt="product.title"
              class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
              loading="lazy"
            >
          </a>

          <template x-if="product.compare_at_price > product.price">
            <span class="absolute top-2 left-2 bg-destructive text-destructive-foreground text-xs font-medium px-2 py-1 rounded-md">
              Sale
            </span>
          </template>

          <button
            class="absolute bottom-2 right-2 bg-primary text-primary-foreground p-2 rounded-lg opacity-0 translate-y-2 transition-all duration-200 group-hover:opacity-100 group-hover:translate-y-0 hover:bg-primary/90"
            @click.prevent="ShopifyAPI.addToCart(product.variants[0].id, 1)"
            x-show="product.available"
          >
            <i class="ri-add-line text-lg"></i>
          </button>

          <div class="mt-3 space-y-1">
            <h3 class="text-sm font-medium">
              <a :href="product.url" class="hover:underline" x-text="product.title"></a>
            </h3>
            <div class="flex items-center gap-2">
              <span class="text-sm font-semibold" x-text="ShopifyAPI.formatMoney(product.price)"></span>
              <template x-if="product.compare_at_price > product.price">
                <span class="text-sm text-muted-foreground line-through" x-text="ShopifyAPI.formatMoney(product.compare_at_price)"></span>
              </template>
            </div>
          </div>
        </article>
      </template>

      <template x-if="loading">
        <div class="col-span-full flex justify-center py-10">
          <i class="ri-loader-4-line text-3xl animate-spin text-muted-foreground"></i>
        </div>
      </template>
    </div>

    <div class="text-center mt-10">
      <a
        href="{{ collection_url | default: '/collections/all' }}"
        class="inline-flex items-center gap-2 bg-primary text-primary-foreground px-6 py-3 rounded-lg font-medium hover:bg-primary/90 transition-colors"
      >
        View All
        <i class="ri-arrow-right-line"></i>
      </a>
    </div>
  </div>
</section>
